BootStrap: docker
From: nvcr.io/nvidia/pytorch:25.06-py3

%environment
    # matches common transformer env usage
    export TOKENIZERS_PARALLELISM=false

%post
    set -eux

    # --- system deps (Dockerfile apt-get equivalent) ---
    apt-get update
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        git \
        build-essential \
        ninja-build \
        ca-certificates \
        && rm -rf /var/lib/apt/lists/*

    # --- python deps (Dockerfile pip equivalent) ---
    python3 -m pip install --upgrade pip setuptools wheel packaging ninja psutil

    # If you have a requirements file, bake it in:
    if [ -f /opt/requirements_tuner.txt ]; then
        python3 -m pip install -r /opt/requirements_tuner.txt
    fi

    # Flash-attn install (as in your docker build logic)
    python3 -m pip install flash_attn --no-build-isolation

%files
    # bake requirements into the image (optional but recommended)
    requirements_tuner.txt /opt/requirements_tuner.txt

%runscript
    # default run behavior (like Docker CMD)
    cd /app
    exec python3 main.py --preprocess --tune
