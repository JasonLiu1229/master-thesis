BootStrap: docker
From: nvcr.io/nvidia/pytorch:25.06-py3

%environment
    # matches common transformer env usage
    export TOKENIZERS_PARALLELISM=false

%files
    requirements_tuner.txt /opt/requirements_tuner.txt

%post
    set -eux

    export TMPDIR=/var/tmp
    mkdir -p \"$TMPDIR\" /tmp
    chmod 1777 \"$TMPDIR\" /tmp

    apt-get -o Dir::Tmp=/var/tmp update
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        git \
        build-essential \
        ninja-build \
        ca-certificates \
        && rm -rf /var/lib/apt/lists/*

    python3 -m pip install --upgrade pip setuptools wheel packaging ninja psutil

    python3 -m pip install -r /opt/requirements_tuner.txt

    python3 -m pip install flash_attn --no-build-isolation

%runscript
    cd /app
    exec python3 main.py --tune
